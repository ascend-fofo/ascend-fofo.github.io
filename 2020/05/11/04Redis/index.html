<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="">
  <meta name="author" content="ascendfofo">
  <meta name="keywords" content="">
  <title>04Redis ~ 关于我和她的事</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <script>
    daovoice('init', {
      app_id: "56fad1e3",
    });
    daovoice('update');
  </script>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Feeling my love</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/default.png')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期一, 五月 11日 2020, 10:01 上午
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    1.2k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      5 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a><a href="http://redisdoc.com/" target="_blank" rel="noopener">Redis</a></h2><h4 id="windows下安装redis"><a href="#windows下安装redis" class="headerlink" title="windows下安装redis"></a>windows下安装redis</h4><blockquote>
<h4 id="1-下载好Redis"><a href="#1-下载好Redis" class="headerlink" title="1.下载好Redis"></a>1.下载好Redis</h4><h4 id="2-cd到Redis所在目录下，使用命令redis-server-redis-windows-conf"><a href="#2-cd到Redis所在目录下，使用命令redis-server-redis-windows-conf" class="headerlink" title="2.cd到Redis所在目录下，使用命令redis-server redis.windows.conf"></a>2.cd到Redis所在目录下，使用命令redis-server redis.windows.conf</h4><h4 id="3-上一个命令窗口不要关闭，打开新的窗口使用命令redis-cli"><a href="#3-上一个命令窗口不要关闭，打开新的窗口使用命令redis-cli" class="headerlink" title="3.上一个命令窗口不要关闭，打开新的窗口使用命令redis-cli"></a>3.上一个命令窗口不要关闭，打开新的窗口使用命令redis-cli</h4><h4 id="4-进行测试，输入set-test-1-回车-显示ok即可"><a href="#4-进行测试，输入set-test-1-回车-显示ok即可" class="headerlink" title="4.进行测试，输入set test 1  回车  显示ok即可"></a>4.进行测试，输入set test 1  回车  显示ok即可</h4></blockquote>
<h4 id="为什么不需要安装永久服务"><a href="#为什么不需要安装永久服务" class="headerlink" title="为什么不需要安装永久服务"></a>为什么不需要安装永久服务</h4><p>因为工作了以后，你们本机上有没有redis都可以，公司会提供测试环境下的redis服务</p>
<h4 id="什么叫Redis"><a href="#什么叫Redis" class="headerlink" title="什么叫Redis"></a>什么叫Redis</h4><blockquote>
<p><strong><em>Redis是保存在内存中的一个数据库，是以简单的key，value格式来保存数据</em></strong></p>
<p><strong>默认端口号 6379</strong></p>
<h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><p>因为保存在内存中所以存取数据快，redis是单进程单线程的，所以不存在同时操作redis的情况</p>
<h4 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h4><p>Redis不适合保存大量数据，一般作为缓存使用，HashMap</p>
</blockquote>
<h3 id="五个基本数据类型"><a href="#五个基本数据类型" class="headerlink" title="五个基本数据类型"></a>五个基本数据类型</h3><h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><p>命令 ：</p>
<p>保存 set key value</p>
<p>获取 get key</p>
<p>思考：可不可以把对象保存在字符串类型中？</p>
<p>需要一个媒介，就是先把对象转为json格式的字符串，然后使用set命令保存到redis 当中</p>
<p>思考：既然能把对象转为json格式的字符串，那么能不能把已经成为json格式的字符串转回为对象呢？</p>
<p>是可以的 但是需要一个媒介</p>
<p>####哈希（Hash）</p>
<p>命令：</p>
<p>保存 hset key hash的key hash的value</p>
<p>获取 hget key hash的key</p>
<p>获取全部 hgetall key</p>
<p>思考：根据hgetall 命令想一想hash结构适用于什么业务场景？</p>
<p>1.购物车 redis key（用户唯一id）hashkey（gid@img_url@gname@msg） value(num)</p>
<p>2.对象</p>
<p>思考：为什么用@符号进行分割符？</p>
<p>中英文下状态一样</p>
<p>数组有没有length方法？ </p>
<p>没有,但是有length属性</p>
<p>string有没有length方法？</p>
<p>有</p>
<p>####列表(List)</p>
<blockquote>
<p>命令：</p>
<p>保存：</p>
<pre><code class="java">lpush key  value ... 或者 rpush key value（多个value空格分割）
获取：lrange key start  end</code></pre>
<p>思考：适用场景？</p>
<p>单一key对应多个value的场景 比方评论业务，可以重复评论而且有序而且方便分页，</p>
</blockquote>
<h4 id="集合-Set"><a href="#集合-Set" class="headerlink" title="集合(Set)"></a>集合(Set)</h4><blockquote>
<p>使用场景不多</p>
<p>特点：无序且不可重复</p>
<p>命令：</p>
<pre><code class="java">保存  sadd key vaue
获取 SMEMBERS key </code></pre>
</blockquote>
<h4 id="有序集合（Sset）"><a href="#有序集合（Sset）" class="headerlink" title="有序集合（Sset）"></a>有序集合（Sset）</h4><blockquote>
<p>命令：</p>
<p>保存：zadd key score value score value …</p>
<p>获取：zrange key start end</p>
<p>这里注意不要把score值变得重复</p>
<p>适用场景：</p>
<p>某个需要不能重复的，但是可以无序的场景</p>
</blockquote>
<h3 id="将Redis集成到Springboot中"><a href="#将Redis集成到Springboot中" class="headerlink" title="将Redis集成到Springboot中"></a>将Redis集成到Springboot中</h3><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><blockquote>
<h4 id="①依赖"><a href="#①依赖" class="headerlink" title="①依赖"></a>①依赖</h4><pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<h4 id="②配置-配置类，配置文件"><a href="#②配置-配置类，配置文件" class="headerlink" title="②配置(配置类，配置文件)"></a>②配置(配置类，配置文件)</h4><blockquote>
<p>配置文件：</p>
<pre><code class="properties">spring.redis.host=localhost
spring.redis.port=6379</code></pre>
<p>配置类：</p>
<pre><code class="java">@Configuration
public class RedisConfig {
   @Bean
   public RedisTemplate&lt;String,Object&gt; redisTemplate(RedisConnectionFactory factory){
       RedisTemplate&lt;String,Object&gt; template = new RedisTemplate&lt;String,Object&gt;();
       template.setConnectionFactory(factory);
       Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);
       ObjectMapper om = new ObjectMapper();
       om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
       om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
       jackson2JsonRedisSerializer.setObjectMapper(om);
       StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();
       //key序列化
       template.setKeySerializer(stringRedisSerializer);
       //hashkey序列化
       template.setHashKeySerializer(stringRedisSerializer);
       //value序列化使用jackson
       template.setValueSerializer(jackson2JsonRedisSerializer);
       //hashvalue序列化使用jackson
       template.setHashValueSerializer(jackson2JsonRedisSerializer);
       template.afterPropertiesSet();
       return template;
   }
}</code></pre>
</blockquote>
<h4 id="③使用"><a href="#③使用" class="headerlink" title="③使用"></a>③使用</h4><pre><code class="java">添加redisutils
public class RedisUtils {

   @Autowired
   private RedisTemplate&lt;String, Object&gt; redisTemplate;

   /**
    * string 类型存入
    *
    * @param key
    * @param value
    * @return
    */
   public boolean set(String key, Object value) {
       //todo
       try {
           redisTemplate.opsForValue().set(key, value);
           return true;
       } catch (Exception e) {
           e.printStackTrace();
           return false;
       }
   }

   /**
    * string 类型获取
    * @param key
    * @return
    */
   public Object get(String key) {
       return key == null ? null : redisTemplate.opsForValue().get(key);
   }

 /**
    * 删除可以多个删除
    * @param key
    */
   public void del(String... key) {
       if (key != null &amp;&amp; key.length &gt; 0) {
           if (key.length == 1) {
               redisTemplate.delete(key[0]);
           } else {
               redisTemplate.delete(CollectionUtils.arrayToList(key));
           }
       }
   }

 /**
    * 指定key失效时间
    * @param key
    * @param time
    * @return
    */
   public boolean expire(String key, long time) {
       try {
           if (time &gt; 0) {
               redisTemplate.expire(key, time, TimeUnit.SECONDS);
           }
           return true;
       } catch (Exception e) {
           e.printStackTrace();
           return false;
       }
   }
}</code></pre>
</blockquote>
<h4 id="思考为什么要序列化？"><a href="#思考为什么要序列化？" class="headerlink" title="思考为什么要序列化？"></a>思考为什么要序列化？</h4><p>在java中，一切都可以叫对象，而我们想要将对象进行信息传输（报错）或者存储（否则乱码）的时候就需要进行序列化</p>
<h4 id="理解了对象需要序列化，那么为什么我们要去重写之前springboot自带的redisTemplate？"><a href="#理解了对象需要序列化，那么为什么我们要去重写之前springboot自带的redisTemplate？" class="headerlink" title="理解了对象需要序列化，那么为什么我们要去重写之前springboot自带的redisTemplate？"></a>理解了对象需要序列化，那么为什么我们要去重写之前springboot自带的redisTemplate？</h4><p>找到org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration这个类</p>
<p>这是在springboot启动的时候就被加载的配置类，现在先看redisTemplate这个方法，现在发现这个方法泛型中皆为obj</p>
<p>那么每次都需要进行转值比较麻烦。</p>
<p>那么再看下面的stringRedisTemplate方法提供的泛型是string,string不够灵活而且缺少序列化k与v</p>
<p>其中有两个标签</p>
<pre><code class="java">@Bean  //相当于spring中&lt;bean&gt;标签的作用
@ConditionalOnMissingBean //山中无老虎猴子称大王 如果有其他的同名的bean则会被覆盖</code></pre>
<h4 id="在spring中提供了若干的序列化器"><a href="#在spring中提供了若干的序列化器" class="headerlink" title="在spring中提供了若干的序列化器"></a>在spring中提供了若干的序列化器</h4><p>Jackson2JsonRedisSerializer 就是一个序列化器</p>
<h4 id="课外"><a href="#课外" class="headerlink" title="课外"></a>课外</h4><p><strong><em>String… key</em></strong> 参数里写这个可以有多个也可以传入单个字符串，当单个字符串进入方法后会自动转换为数组，所以取值要按数组的方式来进行取值如：array[0]</p>
<p><strong>Collection</strong> 是所有集合的父类</p>
<p><strong>Collections</strong> 提供了集合的工具类，提供了对集合操作的一些方法</p>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      
  <div id="vcomments" style="width: 90%; margin: 0 auto;"></div>
  <script defer src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script defer src="//unpkg.com/valine/dist/Valine.min.js"></script>

  <script>
    var notify = 'false' === true;
    var verify = 'false' === true;
    var oldLoad = window.onload;
    window.onload = function () {
      new Valine({
        el: '#vcomments',
        notify: notify,
        verify: verify,
        app_id: "AwHMHsWD84HCneUlPvBR9ivb-gzGzoHsz",
        app_key: "XEA3AdfEE5lN8EJi57fb60qq",
        placeholder: "ヾﾉ≧∀≦)o来啊，快活啊!",
        avatar: "retro",
        meta: ['nick', 'mail', 'link'],
        pageSize: "10",
      });
      oldLoad && oldLoad();
    };
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://valine.js.org" target="_blank" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://weibo.com/u/5664910152?is_hot=1" target="_blank" rel="nofollow noopener"><b>Dung</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://weibo.com/u/2692542685?is_hot=1" target="_blank" rel="nofollow noopener"> <b>北野时生</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    


    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  <!-- cnzz Analytics -->
  



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "04Redis&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 20,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>











</body>
</html>
